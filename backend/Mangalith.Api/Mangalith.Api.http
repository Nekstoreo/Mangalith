
@baseUrl = https://localhost:5001
@apiBase = http://localhost:5000

@healthUrl = {{baseUrl}}/health
@registerUrl = {{baseUrl}}/api/auth/register
@loginUrl = {{baseUrl}}/api/auth/login
@profileUrl = {{baseUrl}}/api/profile/me

@random = {{$randomInt}}
@userEmail = test-user-{{random}}@example.com
@password = Passw0rd!{{random}}a

### Health check
GET {{healthUrl}}
Accept: application/json

### Register a new user (optional)
# @name register
POST {{registerUrl}}
Content-Type: application/json
Accept: application/json

{
  "email": "{{userEmail}}",
  "password": "{{password}}",
  "confirmPassword": "{{password}}",
  "fullName": "Test User {{random}}"
}

### Login and save token
# @name login
POST {{loginUrl}}
Content-Type: application/json
Accept: application/json

{
  "email": "{{userEmail}}",
  "password": "{{password}}"
}

### Upload file (uses token from login response)
### NOTE: this posts to the API project (http://localhost:5000) which is the Kestrel HTTP endpoint in dev
POST {{apiBase}}/api/files/upload
Authorization: Bearer {{login.response.body.accessToken}}
Content-Type: multipart/form-data; boundary=----WebKitFormBoundary7MA4YWxkTrZu0gW

------WebKitFormBoundary7MA4YWxkTrZu0gW
Content-Disposition: form-data; name="file"; filename="sample.cbr"
Content-Type: application/x-rar-compressed

< ./test-files/sample.cbr
------WebKitFormBoundary7MA4YWxkTrZu0gW
Content-Disposition: form-data; name="title"

Test Manga Title
------WebKitFormBoundary7MA4YWxkTrZu0gW
Content-Disposition: form-data; name="description"

This is a test manga upload
------WebKitFormBoundary7MA4YWxkTrZu0gW--

### Get uploaded file (uses token and fileId from upload response)
GET {{apiBase}}/api/files/{{upload.response.body.fileId}}
Authorization: Bearer {{login.response.body.accessToken}}

### Delete uploaded file
DELETE {{apiBase}}/api/files/{{upload.response.body.fileId}}
Authorization: Bearer {{login.response.body.accessToken}}

### Variables (defaults)
@apiBase = http://localhost:5000
@baseUrl = https://localhost:5001
@random = {{$randomInt}}
@userEmail = test-user-{{random}}@example.com
@password = Passw0rd!{{random}}a
